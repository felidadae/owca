# Full example for Kubernetes running as daemonset (in-cluster k8s config)
# Requires environment variables:
# - KUBERNETES_SERVICE_HOST - provided by default by Kuberenetes
# - KUBERNETES_SERVICE_PORT - provided by default by Kubernetes
# - HOST_IP - need to explicitly enabled in Pod spec using downward-api
# - HOSTNAME - default provided by OS

runner: !MeasurementRunner
  interval: 5.0
  node: !KubernetesNode
    cgroup_driver: cgroupfs
    monitored_namespaces: ["default"]
    kubeapi_host: !Env KUBERNETES_SERVICE_HOST
    kubeapi_port: !Env KUBERNETES_SERVICE_PORT
    node_ip: !Env HOST_IP


  metrics_storage: !LogStorage
    overwrite: True
    output_filename: /var/lib/wca/metrics.prom

  extra_labels:
    node: !Env HOSTNAME
  event_names:
    - task_cycles # do not remove: USED BY E2E tests
    - task_instructions
    # -------------------------------------------------------------------
    - task_offcore_requests_demand_data_rd # required fro R/W characterization
    - task_offcore_requests_demand_rfo
    # -------------------------------------------------------------------
    # - offcore_response__all_pf_data__l3_miss_any_snoop__rB701003FBC000490
    # - offcore_response__demand_data__l3_miss_any_snoop__rB701003FBC000001
    # - l2_lines_in_all__r1ff1
    # - l2_trans_l2_wb__r40f0
    # -------------------------------------------------------------------
    # - mem_inst_retired_all_loads__r81d0
    # - mem_inst_retired_all_stores__r82d0
    # - mem_load_l3_miss_retired_local_dram__r01d3
    # - mem_load_l3_miss_retired_remote_dram__r02d3

  enable_derived_metrics: True
  uncore_event_names:
    - platform_cas_count_reads
    - platform_cas_count_writes
    - platform_pmm_bandwidth_reads
    - platform_pmm_bandwidth_writes

  wss_reset_interval: 1
  gather_hw_mm_topology: True
